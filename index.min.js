(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsPublicGatewayChecker = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IpfsPublicGatewayChecker=(()=>{var vt=Object.create;var ut=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var xt=Object.getOwnPropertyNames;var Tt=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty;var Rt=(h,e)=>()=>(e||h((e={exports:{}}).exports,e),e.exports);var At=(h,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of xt(e))!Et.call(h,n)&&n!==i&&ut(h,n,{get:()=>e[n],enumerable:!(o=bt(e,n))||o.enumerable});return h};var St=(h,e,i)=>(i=h!=null?vt(Tt(h)):{},At(e||!h||!h.__esModule?ut(i,"default",{value:h,enumerable:!0}):i,h));var dt=Rt((J,lt)=>{(function(h){"use strict";function e(i){var o=i&&i.Promise||h.Promise,n=i&&i.XMLHttpRequest||h.XMLHttpRequest;return function(){var m=Object.create(h,{fetch:{value:void 0,writable:!0}});return function(w,f){typeof J=="object"&&typeof lt<"u"?f(J):typeof define=="function"&&define.amd?define(["exports"],f):f(w.WHATWGFetch={})}(this,function(w){"use strict";var f=typeof m<"u"&&m||typeof self<"u"&&self||typeof f<"u"&&f,k={searchParams:"URLSearchParams"in f,iterable:"Symbol"in f&&"iterator"in Symbol,blob:"FileReader"in f&&"Blob"in f&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in f,arrayBuffer:"ArrayBuffer"in f};function Q(t){return t&&DataView.prototype.isPrototypeOf(t)}if(k.arrayBuffer)var T=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],U=ArrayBuffer.isView||function(t){return t&&T.indexOf(Object.prototype.toString.call(t))>-1};function E(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function H(t){return typeof t!="string"&&(t=String(t)),t}function a(t){var r={next:function(){var c=t.shift();return{done:c===void 0,value:c}}};return k.iterable&&(r[Symbol.iterator]=function(){return r}),r}function l(t){this.map={},t instanceof l?t.forEach(function(r,c){this.append(c,r)},this):Array.isArray(t)?t.forEach(function(r){this.append(r[0],r[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(r){this.append(r,t[r])},this)}l.prototype.append=function(t,r){t=E(t),r=H(r);var c=this.map[t];this.map[t]=c?c+", "+r:r},l.prototype.delete=function(t){delete this.map[E(t)]},l.prototype.get=function(t){return t=E(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(E(t))},l.prototype.set=function(t,r){this.map[E(t)]=H(r)},l.prototype.forEach=function(t,r){for(var c in this.map)this.map.hasOwnProperty(c)&&t.call(r,this.map[c],c,this)},l.prototype.keys=function(){var t=[];return this.forEach(function(r,c){t.push(c)}),a(t)},l.prototype.values=function(){var t=[];return this.forEach(function(r){t.push(r)}),a(t)},l.prototype.entries=function(){var t=[];return this.forEach(function(r,c){t.push([c,r])}),a(t)},k.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);function u(t){if(t.bodyUsed)return o.reject(new TypeError("Already read"));t.bodyUsed=!0}function v(t){return new o(function(r,c){t.onload=function(){r(t.result)},t.onerror=function(){c(t.error)}})}function d(t){var r=new FileReader,c=v(r);return r.readAsArrayBuffer(t),c}function S(t){var r=new FileReader,c=v(r);return r.readAsText(t),c}function p(t){for(var r=new Uint8Array(t),c=new Array(r.length),g=0;g<r.length;g++)c[g]=String.fromCharCode(r[g]);return c.join("")}function z(t){if(t.slice)return t.slice(0);var r=new Uint8Array(t.byteLength);return r.set(new Uint8Array(t)),r.buffer}function q(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:k.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:k.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:k.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():k.arrayBuffer&&k.blob&&Q(t)?(this._bodyArrayBuffer=z(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):k.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||U(t))?this._bodyArrayBuffer=z(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):k.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},k.blob&&(this.blob=function(){var t=u(this);if(t)return t;if(this._bodyBlob)return o.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return o.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=u(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?o.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):o.resolve(this._bodyArrayBuffer))}else return this.blob().then(d)}),this.text=function(){var t=u(this);if(t)return t;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(p(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return o.resolve(this._bodyText)},k.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}var ht=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function s(t){var r=t.toUpperCase();return ht.indexOf(r)>-1?r:t}function C(t,r){if(!(this instanceof C))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r=r||{};var c=r.body;if(t instanceof C){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,r.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!c&&t._bodyInit!=null&&(c=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=r.credentials||this.credentials||"same-origin",(r.headers||!this.headers)&&(this.headers=new l(r.headers)),this.method=s(r.method||this.method||"GET"),this.mode=r.mode||this.mode||null,this.signal=r.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&c)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(c),(this.method==="GET"||this.method==="HEAD")&&(r.cache==="no-store"||r.cache==="no-cache")){var g=/([?&])_=[^&]*/;if(g.test(this.url))this.url=this.url.replace(g,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}C.prototype.clone=function(){return new C(this,{body:this._bodyInit})};function N(t){var r=new FormData;return t.trim().split("&").forEach(function(c){if(c){var g=c.split("="),_=g.shift().replace(/\+/g," "),y=g.join("=").replace(/\+/g," ");r.append(decodeURIComponent(_),decodeURIComponent(y))}}),r}function V(t){var r=new l,c=t.replace(/\r?\n[\t ]+/g," ");return c.split("\r").map(function(g){return g.indexOf(`
`)===0?g.substr(1,g.length):g}).forEach(function(g){var _=g.split(":"),y=_.shift().trim();if(y){var X=_.join(":").trim();r.append(y,X)}}),r}q.call(C.prototype);function x(t,r){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');r||(r={}),this.type="default",this.status=r.status===void 0?200:r.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in r?r.statusText:"",this.headers=new l(r.headers),this.url=r.url||"",this._initBody(t)}q.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},x.error=function(){var t=new x(null,{status:0,statusText:""});return t.type="error",t};var W=[301,302,303,307,308];x.redirect=function(t,r){if(W.indexOf(r)===-1)throw new RangeError("Invalid status code");return new x(null,{status:r,headers:{location:t}})},w.DOMException=f.DOMException;try{new w.DOMException}catch{w.DOMException=function(r,c){this.message=r,this.name=c;var g=Error(r);this.stack=g.stack},w.DOMException.prototype=Object.create(Error.prototype),w.DOMException.prototype.constructor=w.DOMException}function j(t,r){return new o(function(c,g){var _=new C(t,r);if(_.signal&&_.signal.aborted)return g(new w.DOMException("Aborted","AbortError"));var y=new n;function X(){y.abort()}y.onload=function(){var R={status:y.status,statusText:y.statusText,headers:V(y.getAllResponseHeaders()||"")};R.url="responseURL"in y?y.responseURL:R.headers.get("X-Request-URL");var Z="response"in y?y.response:y.responseText;setTimeout(function(){c(new x(Z,R))},0)},y.onerror=function(){setTimeout(function(){g(new TypeError("Network request failed"))},0)},y.ontimeout=function(){setTimeout(function(){g(new TypeError("Network request failed"))},0)},y.onabort=function(){setTimeout(function(){g(new w.DOMException("Aborted","AbortError"))},0)};function _t(R){try{return R===""&&f.location.href?f.location.href:R}catch{return R}}y.open(_.method,_t(_.url),!0),_.credentials==="include"?y.withCredentials=!0:_.credentials==="omit"&&(y.withCredentials=!1),"responseType"in y&&(k.blob?y.responseType="blob":k.arrayBuffer&&_.headers.get("Content-Type")&&_.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(y.responseType="arraybuffer")),r&&typeof r.headers=="object"&&!(r.headers instanceof l)?Object.getOwnPropertyNames(r.headers).forEach(function(R){y.setRequestHeader(R,H(r.headers[R]))}):_.headers.forEach(function(R,Z){y.setRequestHeader(Z,R)}),_.signal&&(_.signal.addEventListener("abort",X),y.onreadystatechange=function(){y.readyState===4&&_.signal.removeEventListener("abort",X)}),y.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}j.polyfill=!0,f.fetch||(f.fetch=j,f.Headers=l,f.Request=C,f.Response=x),w.Headers=l,w.Request=C,w.Response=x,w.fetch=j,Object.defineProperty(w,"__esModule",{value:!0})}),{fetch:m.fetch,Headers:m.Headers,Request:m.Request,Response:m.Response,DOMException:m.DOMException}}()}typeof define=="function"&&define.amd?define(function(){return e}):typeof J=="object"?lt.exports=e:h.fetchPonyfill=e})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof globalThis<"u"?globalThis:J)});function Ct(){var h=Object.create(null);h.ftp=21,h.file=0,h.gopher=70,h.http=80,h.https=443,h.ws=80,h.wss=443;var e=Object.create(null);e["%2e"]=".",e[".%2e"]="..",e["%2e."]="..",e["%2e%2e"]="..";function i(a){return h[a]!==void 0}function o(){U.call(this),this._isInvalid=!0}function n(a){return a==""&&o.call(this),a.toLowerCase()}function m(a){var l=a.charCodeAt(0);return l>32&&l<127&&[34,35,60,62,63,96].indexOf(l)==-1?a:encodeURIComponent(a)}function w(a){var l=a.charCodeAt(0);return l>32&&l<127&&[34,35,60,62,96].indexOf(l)==-1?a:encodeURIComponent(a)}var f=void 0,k=/[a-zA-Z]/,Q=/[a-zA-Z0-9\+\-\.]/;function T(a,l,u){function v(r){ht.push(r)}var d=l||"scheme start",S=0,p="",z=!1,q=!1,ht=[];t:for(;(a[S-1]!=f||S==0)&&!this._isInvalid;){var s=a[S];switch(d){case"scheme start":if(s&&k.test(s))p+=s.toLowerCase(),d="scheme";else if(l){v("Invalid scheme.");break t}else{p="",d="no scheme";continue}break;case"scheme":if(s&&Q.test(s))p+=s.toLowerCase();else if(s==":"){if(this._scheme=p,p="",l)break t;i(this._scheme)&&(this._isRelative=!0),this._scheme=="file"?d="relative":this._isRelative&&u&&u._scheme==this._scheme?d="relative or authority":this._isRelative?d="authority first slash":d="scheme data"}else if(l){if(f==s)break t;v("Code point not allowed in scheme: "+s);break t}else{p="",S=0,d="no scheme";continue}break;case"scheme data":s=="?"?(this._query="?",d="query"):s=="#"?(this._fragment="#",d="fragment"):f!=s&&s!="	"&&s!=`
`&&s!="\r"&&(this._schemeData+=m(s));break;case"no scheme":if(!u||!i(u._scheme))v("Missing scheme."),o.call(this);else{d="relative";continue}break;case"relative or authority":if(s=="/"&&a[S+1]=="/")d="authority ignore slashes";else{v("Expected /, got: "+s),d="relative";continue}break;case"relative":if(this._isRelative=!0,this._scheme!="file"&&(this._scheme=u._scheme),f==s){this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query=u._query,this._username=u._username,this._password=u._password;break t}else if(s=="/"||s=="\\")s=="\\"&&v("\\ is an invalid code point."),d="relative slash";else if(s=="?")this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query="?",this._username=u._username,this._password=u._password,d="query";else if(s=="#")this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query=u._query,this._fragment="#",this._username=u._username,this._password=u._password,d="fragment";else{var C=a[S+1],N=a[S+2];(this._scheme!="file"||!k.test(s)||C!=":"&&C!="|"||f!=N&&N!="/"&&N!="\\"&&N!="?"&&N!="#")&&(this._host=u._host,this._port=u._port,this._username=u._username,this._password=u._password,this._path=u._path.slice(),this._path.pop()),d="relative path";continue}break;case"relative slash":if(s=="/"||s=="\\")s=="\\"&&v("\\ is an invalid code point."),this._scheme=="file"?d="file host":d="authority ignore slashes";else{this._scheme!="file"&&(this._host=u._host,this._port=u._port,this._username=u._username,this._password=u._password),d="relative path";continue}break;case"authority first slash":if(s=="/")d="authority second slash";else{v("Expected '/', got: "+s),d="authority ignore slashes";continue}break;case"authority second slash":if(d="authority ignore slashes",s!="/"){v("Expected '/', got: "+s);continue}break;case"authority ignore slashes":if(s!="/"&&s!="\\"){d="authority";continue}else v("Expected authority, got: "+s);break;case"authority":if(s=="@"){z&&(v("@ already seen."),p+="%40"),z=!0;for(var V=0;V<p.length;V++){var x=p[V];if(x=="	"||x==`
`||x=="\r"){v("Invalid whitespace in authority.");continue}if(x==":"&&this._password===null){this._password="";continue}var W=m(x);this._password!==null?this._password+=W:this._username+=W}p=""}else if(f==s||s=="/"||s=="\\"||s=="?"||s=="#"){S-=p.length,p="",d="host";continue}else p+=s;break;case"file host":if(f==s||s=="/"||s=="\\"||s=="?"||s=="#"){p.length==2&&k.test(p[0])&&(p[1]==":"||p[1]=="|")?d="relative path":(p.length==0||(this._host=n.call(this,p),p=""),d="relative path start");continue}else s=="	"||s==`
`||s=="\r"?v("Invalid whitespace in file host."):p+=s;break;case"host":case"hostname":if(s==":"&&!q){if(this._host=n.call(this,p),p="",d="port",l=="hostname")break t}else if(f==s||s=="/"||s=="\\"||s=="?"||s=="#"){if(this._host=n.call(this,p),p="",d="relative path start",l)break t;continue}else s!="	"&&s!=`
`&&s!="\r"?(s=="["?q=!0:s=="]"&&(q=!1),p+=s):v("Invalid code point in host/hostname: "+s);break;case"port":if(/[0-9]/.test(s))p+=s;else if(f==s||s=="/"||s=="\\"||s=="?"||s=="#"||l){if(p!=""){var j=parseInt(p,10);j!=h[this._scheme]&&(this._port=j+""),p=""}if(l)break t;d="relative path start";continue}else s=="	"||s==`
`||s=="\r"?v("Invalid code point in port: "+s):o.call(this);break;case"relative path start":if(s=="\\"&&v("'\\' not allowed in path."),d="relative path",s!="/"&&s!="\\")continue;break;case"relative path":if(f==s||s=="/"||s=="\\"||!l&&(s=="?"||s=="#")){s=="\\"&&v("\\ not allowed in relative path.");var t;(t=e[p.toLowerCase()])&&(p=t),p==".."?(this._path.pop(),s!="/"&&s!="\\"&&this._path.push("")):p=="."&&s!="/"&&s!="\\"?this._path.push(""):p!="."&&(this._scheme=="file"&&this._path.length==0&&p.length==2&&k.test(p[0])&&p[1]=="|"&&(p=p[0]+":"),this._path.push(p)),p="",s=="?"?(this._query="?",d="query"):s=="#"&&(this._fragment="#",d="fragment")}else s!="	"&&s!=`
`&&s!="\r"&&(p+=m(s));break;case"query":!l&&s=="#"?(this._fragment="#",d="fragment"):f!=s&&s!="	"&&s!=`
`&&s!="\r"&&(this._query+=w(s));break;case"fragment":f!=s&&s!="	"&&s!=`
`&&s!="\r"&&(this._fragment+=s);break}S++}}function U(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function E(a,l){l!==void 0&&!(l instanceof E)&&(l=new E(String(l))),a=String(a),this._url=a,U.call(this);var u=a.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");T.call(this,u,null,l)}E.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var a="";return(this._username!=""||this._password!=null)&&(a=this._username+(this._password!=null?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+a+this.host:"")+this.pathname+this._query+this._fragment},set href(a){U.call(this),T.call(this,a)},get protocol(){return this._scheme+":"},set protocol(a){this._isInvalid||T.call(this,a+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(a){this._isInvalid||!this._isRelative||T.call(this,a,"host")},get hostname(){return this._host},set hostname(a){this._isInvalid||!this._isRelative||T.call(this,a,"hostname")},get port(){return this._port},set port(a){this._isInvalid||!this._isRelative||T.call(this,a,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(a){this._isInvalid||!this._isRelative||(this._path=[],T.call(this,a,"relative path start"))},get search(){return this._isInvalid||!this._query||this._query=="?"?"":this._query},set search(a){this._isInvalid||!this._isRelative||(this._query="?",a[0]=="?"&&(a=a.slice(1)),T.call(this,a,"query"))},get hash(){return this._isInvalid||!this._fragment||this._fragment=="#"?"":this._fragment},set hash(a){this._isInvalid||(this._fragment="#",a[0]=="#"&&(a=a.slice(1)),T.call(this,a,"fragment"))},get origin(){var a;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return a=this.host,a?this._scheme+"://"+a:""}};var H=self.URL;return H&&(E.createObjectURL=function(a){return H.createObjectURL.apply(H,arguments)},E.revokeObjectURL=function(a){H.revokeObjectURL(a)}),E}var I=Ct();var yt=St(dt());var L=class{constructor(e="div",i=void 0,o="\u{1F551}"){let n=document.createElement(e);this.element=n,i!=null&&(this.className=i),this.textContent=o}static fromElement(e){let i=new L("div");return i.element=e,i}asterisk(){this.textContent="*"}lose(){this.textContent="\u274C"}win(e){if(e!=null){this.textContent="";let i=document.createElement("a");i.href=e,i.target="_blank",i.textContent="\u2705",this.element.title=e,this.element.appendChild(i)}else this.textContent="\u2705"}global(){this.textContent="\u{1F30D}"}err(){this.textContent="\u26A0\uFE0F"}empty(){this.textContent=""}get style(){return this.element.style}append(e){return e instanceof L&&(e=e.element),this.element.append(e)}get classList(){return this.element.classList}set title(e){this.element.title=e}set className(e){this.element.className=e}set textContent(e){this.element.textContent=e}};var A=class{constructor(e,...i){this.parent=e;this.tag=new L(...i)}};var Y=class extends A{constructor(i,...o){super(i,...o);this.parent=i;this._className="Not-set";this._tagName="Not-set"}get className(){return this._className}get tagName(){return this._tagName}check(){}checked(){}onerror(){this.tag.err()}};var B="bafybeifx7yeb55armcsxwwitkymga5xf53dxiarykms3ygqic223w5sk3m",O="bafybeibwzifw52ttrkqlikfzext5akxu7lz4xiwjgwzmqcpdzmp3n5vnbe",mt="Hello from IPFS Gateway Checker";var b=class{constructor(e){this.namespace=e}log(e,...i){let[o,...n]=i,m=this.namespace!=null?`${this.namespace}.${e}: `:"";console[e](`${m}${o}`,...n)}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}};var{fetch:It}=(0,yt.default)(),pt=new b("Cors"),K=class extends Y{constructor(i){super(i,"div","Cors");this.parent=i;this._className="Cors";this._tagName="div"}async check(){let i=Date.now(),n=`${this.parent.gateway.replace(":hash",B)}?now=${i}#x-ipfs-companion-no-redirect`;try{let m=await It(n),{status:w}=m,f=await m.text();if(this.tag.title=`Response code: ${w}`,mt===f.trim())this.tag.asterisk(),this.parent.tag.classList.add("cors");else throw pt.debug("The response text did not match the expected string"),this.onerror(),new Error(`URL '${n} does not support CORS`)}catch(m){throw pt.error(m),this.onerror(),m}}checked(){pt.warn("Not implemented yet")}onerror(){this.tag.empty()}};var ft=window.IpfsHttpClient({host:"ipfs.io",port:443,protocol:"https"});window.client=ft;var $=class{constructor({tokensPerInterval:e,interval:i,stopped:o}){if(this.tokensPerInterval=e,this._isStopped=o,typeof i=="string")switch(i){case"sec":case"second":{this.interval=1e3;break}case"min":case"minute":{this.interval=1e3*60;break}case"hr":case"hour":{this.interval=1e3*60*60;break}case"day":{this.interval=1e3*60*60*24;break}default:throw new Error("Invalid interval "+i)}else this.interval=i;this.tokensRemovedAt=[],this.awaitingRestart=new Set}dripTokens(){throw new Error("dripTokens() not implemented")}getDelayForTokens(){throw new Error("getDelayForTokens() not implemented")}getTokens(){return this.dripTokens(),Math.floor(this.tokens)}tryRemoveTokens(e){return this.dripTokens(),e>this.tokens?!1:(this.tokens-=e,this.tokensRemovedAt.push([Date.now(),e]),!0)}async awaitTokens(e=1){this._isStopped&&await new Promise(o=>this.awaitingRestart.add(o));let i=this.getDelayForTokens(e);return i===0?Math.floor(this.tokens):(await new Promise(o=>setTimeout(()=>o(),i)),this.awaitTokens(e))}reset(){this.awaitingRestart.forEach(e=>e())}stop(e=!0){this._isStopped=!0,e&&this.tryRemoveTokens(this.getTokens())}start(){this._isStopped=!1}get isStopped(){return this._isStopped}};var F=class extends ${constructor({bucketSize:e,tokensPerInterval:i,interval:o,stopped:n=!1}){super({tokensPerInterval:i,interval:o,stopped:n}),this.bucketSize=e,this.tokens=n?0:this.bucketSize,this.tokensRemovedAt=n?[0]:[Date.now()]}dripTokens(){if(this._isStopped)return;let e=Date.now(),i=this.tokensRemovedAt[0],o=Math.max(e-i,0);this.tokensRemovedAt=[e];let n=o*(this.tokensPerInterval/this.interval);return this.tokens=Math.min(this.tokens+n,this.bucketSize),Math.floor(this.tokens)}getDelayForTokens(e=1){if(e>this.bucketSize)throw new Error(`Cannot supply ${e} tokens at once (max is bucketSize = ${this.bucketSize}`);this.dripTokens();let i=e-this.tokens;if(i<=0)return 0;if(!this._isStopped)return Math.ceil(i*(this.interval/this.tokensPerInterval))}reset(){this._isStopped=!1,this.tokens=this.bucketSize,this.tokensRemovedAt=[Date.now()],super.reset()}};var M=new b("Flag"),P=class extends A{constructor(i,o){super(i,"div","Flag");this.parent=i;this.hostname=o}async check(){let i=!0;try{let o=localStorage.getItem(this.hostname);if(o!=null){let n=JSON.parse(o),m=Date.now(),w=n.time,f=m-w,k=7*24*60*60*1e3;f<k&&(i=!1,this.onResponse(n))}}catch(o){throw M.error(`error while getting savedSTR for ${this.hostname}`,o),this.onError(),o}if(i){this.startLimiters();let o=await this.waitForAvailableEndpoint();await this.dnsRequest(o)}}startLimiters(){P.googleLimiter.isStopped===!0&&P.googleLimiter.start(),P.cloudFlareLimiter.isStopped===!0&&P.cloudFlareLimiter.start()}async waitForAvailableEndpoint(){let i=await Promise.race([P.googleLimiter.awaitTokens(1).then(()=>P.googleLimiter.tryRemoveTokens(1)).then(o=>{if(o)return`https://dns.google/resolve?name=${this.hostname}&type=A`}),P.cloudFlareLimiter.awaitTokens(1).then(()=>P.cloudFlareLimiter.tryRemoveTokens(1)).then(o=>{if(o)return`https://cloudflare-dns.com/dns-query?name=${this.hostname}&type=A`})]);return i??(M.info("we awaited tokens, but could not retrieve any.. restarting dnsRequest"),await this.waitForAvailableEndpoint())}async dnsRequest(i){try{let n=await(await fetch(i,{method:"GET",headers:{Accept:"application/dns-json"}})).json();await this.handleDnsQueryResponse(n)}catch(o){M.error("problem submitting DNS request",o),this.onError()}}async handleDnsQueryResponse(i){if(i.Answer==null)return M.error('Response does not contain the "Answer" property:',i),this.onError();let o=null;for(let n=0;n<i.Answer.length&&o==null;n++){let m=i.Answer[n];m.type===1&&(o=m.data)}if(o!=null)try{let n=await window.IpfsGeoip.lookup(ft,o);if(n?.country_code!=null){this.onResponse(n),n.time=Date.now();let m=JSON.stringify(n);localStorage.setItem(this.hostname,m)}else M.error("geoipResponse.country_code is null")}catch(n){M.error(`error while getting DNS A record for ${this.hostname}`,n),this.onError()}else M.error("IP is still null",i)}onError(){this.tag.empty()}onResponse(i){this.tag.style.setProperty("background-image",`url('https://ipfs.io/ipfs/QmaYjj5BHGAWfopTdE8ESzypbuthsZqTeqz9rEuh3EJZi6/${i.country_code.toLowerCase()}.svg')`),this.tag.title=i.country_name,this.tag.empty()}},G=P;G.googleLimiter=new F({bucketSize:1,tokensPerInterval:1,interval:1e3*2,stopped:!0}),G.cloudFlareLimiter=new F({bucketSize:1,tokensPerInterval:1,interval:1e3*2,stopped:!0});var tt=new b("expectSubdomainRedirect");async function gt(h){let{redirected:e,url:i}=await fetch(h.toString());tt.debug("redirected: ",e),tt.debug("responseUrl: ",i),e&&tt.debug("definitely redirected");let{hostname:o}=new I(i);if(!o.startsWith(O)){let n=`Expected ${h.toString()} to redirect to subdomain '${O}' but instead received '${i}'`;throw tt.debug(n),new Error(n)}}async function et(h){return await new Promise((i,o)=>{let n=new Image,m=setTimeout(()=>{o(new Error(`Timeout when attempting to load img from '${n.src}`))},15e3),w=(f,k,Q,T,U)=>{clearTimeout(m),U==null?o(new Error(`Unknown Error when attempting to load img from '${n.src}`)):o(U)};n.onerror=w,n.onload=()=>{clearTimeout(m),i()},n.src=h.toString()})}var Lt=new b("Origin"),st=class{constructor(e){this.parent=e;this.tag=new L("div","Origin")}async check(){let e=new I(this.parent.gateway),i=new I(`${e.protocol}//${O}.ipfs.${e.hostname}/?now=${Date.now()}&filename=1x1.png#x-ipfs-companion-no-redirect`),o=new I(`${e.protocol}//${e.hostname}/ipfs/${O}?now=${Date.now()}&filename=1x1.png#x-ipfs-companion-no-redirect`);await et(i).then(async()=>await gt(o)).then(()=>{this.tag.win(i.toString()),this.parent.tag.classList.add("origin")}).catch(n=>this.onerror(n))}onerror(e){throw Lt.error(e),this.tag.err(),e}};var Dt=new b("Status"),it=class extends A{constructor(i){super(i,"div","Status");this.parent=i;this._up=!1;this._down=!1}async check(){let i=new I(this.parent.gateway),o=new I(`${i.protocol}//${i.hostname}/ipfs/${O}?now=${Date.now()}&filename=1x1.png#x-ipfs-companion-no-redirect`);await et(o).catch(n=>{throw n!=null&&Dt.error(this.parent.gateway,n),n})}get down(){return this._down}set down(i){!this.up&&!this.down&&(this._down=!0,this.tag.lose())}get up(){return this._up}set up(i){!this.up&&!this.down&&(this._up=!0,this.tag.global(),this.parent.tag.classList.add("online"))}onerror(){throw new Error("Not implemented")}};function ct(h){let e=h.toString();return h?.hostname!=null&&(e=h.hostname.toString()),e.replace(`${B}.ipfs.`,"").replace(`${B}.`,"")}var D=new b("GatewayNode"),rt=class extends A{constructor(i,o,n){super(i,"div","Node");this.parent=i;this.atLeastOneSuccess=!1;this.tag.empty(),this.tag.style.order=Date.now().toString(),this.status=new it(this),this.tag.append(this.status.tag),this.cors=new K(this),this.tag.append(this.cors.tag),this.origin=new st(this),this.tag.append(this.origin.tag),this.link=document.createElement("div");let m=o.replace(":hash",B);this.link.url=new I(m),this.link.textContent=ct(this.link.url),this.link.className="Link",this.flag=new G(this,this.link.textContent),this.tag.append(this.flag.tag),this.tag.append(this.link),this.took=document.createElement("div"),this.took.className="Took",this.tag.append(this.took),this.gateway=o,this.index=n,this.checkingTime=0}async check(){this.checkingTime=Date.now(),this.flag.check().then(()=>D.debug(this.gateway,"Flag success"));let i=[this.status.check().then(()=>D.debug(this.gateway,"Status success")).then(this.onSuccessfulCheck.bind(this)),this.cors.check().then(()=>D.debug(this.gateway,"CORS success")).then(this.onSuccessfulCheck.bind(this)),this.origin.check().then(()=>D.debug(this.gateway,"Origin success")).then(this.onSuccessfulCheck.bind(this))];await Promise.allSettled(i).then(o=>o.map(n=>n.status)).then(o=>{o.includes("fulfilled")?(D.debug(`For gateway '${this.gateway}', at least one promise was successfully fulfilled`),D.debug(this.gateway,"this.status.up: ",this.status.up),D.debug(this.gateway,"this.status.down: ",this.status.down),this.status.up=!0,D.debug(this.gateway,"this.status.up: ",this.status.up),D.debug(this.gateway,"this.status.down: ",this.status.down)):(this.status.down=!0,D.debug(`For gateway '${this.gateway}', all promises were rejected`))})}onSuccessfulCheck(){if(!this.atLeastOneSuccess){D.info(`For gateway '${this.gateway}', at least one check was successful`),this.atLeastOneSuccess=!0,this.status.up=!0;let i=this.link.url;if(i!=null){let m=ct(i);this.link.innerHTML=`<a title="${m}" href="${i.toString()}#x-ipfs-companion-no-redirect" target="_blank">${m}</a>`}let o=Date.now()-this.checkingTime;this.tag.style.order=o.toString();let n=(o/1e3).toFixed(2);this.took.textContent=`${n}s`}}onerror(){this.tag.err()}};var ot=class{constructor(e){this.parent=e;let i=document.getElementById("checker.results");if(i==null)throw new Error('Element with Id "checker.results" not found.');this.element=i}append(e){this.element.append(e.element)}};var nt=class extends A{constructor(i){super(i);this.parent=i;let o=document.getElementById("checker.stats");if(o==null)throw new Error('Could not find element with Id "checker.stats"');this.tag=L.fromElement(o),this.gateways=document.createElement("div"),this.gateways.textContent="0/0 tested",this.gateways.className="Gateways",this.tag.append(this.gateways),this.totals=document.createElement("div"),this.totals.textContent="0 online",this.totals.className="Totals",this.tag.append(this.totals)}update(){let i=0,o=0;for(let n of this.parent.nodes)n.status.up?i+=1:n.status.down&&(o+=1);this.gateways.textContent=`${i+o}/${this.parent.nodes.length} tested`,this.totals.textContent=`${i} online`}};var Pt=new b("Checker"),at=class{constructor(){this.nodes=[];let e=document.getElementById("checker");if(e==null)throw new Error('Element with Id "checker" not found.');this.element=e,this.stats=new nt(this),this.results=new ot(this),this.updateStats=this.updateStats.bind(this)}updateStats(){this.stats.update()}async checkGateways(e){let i=[];for(let o of e){let n=new rt(this.results,o,this.nodes.length);this.nodes.push(n),this.results.append(n.tag),setTimeout(()=>{i.push(n.check().catch(m=>Pt.error(m)).finally(this.updateStats))},100*this.nodes.length)}}};var wt=["https://ipfs.io/ipfs/:hash","https://dweb.link/ipfs/:hash","https://gateway.ipfs.io/ipfs/:hash","https://ninetailed.ninja/ipfs/:hash","https://via0.com/ipfs/:hash","https://ipfs.eternum.io/ipfs/:hash","https://hardbin.com/ipfs/:hash","https://cloudflare-ipfs.com/ipfs/:hash","https://astyanax.io/ipfs/:hash","https://cf-ipfs.com/ipfs/:hash","https://ipns.co/ipfs/:hash","https://ipfs.mrh.io/ipfs/:hash","https://gateway.originprotocol.com/ipfs/:hash","https://gateway.pinata.cloud/ipfs/:hash","https://ipfs.sloppyta.co/ipfs/:hash","https://ipfs.busy.org/ipfs/:hash","https://ipfs.greyh.at/ipfs/:hash","https://gateway.serph.network/ipfs/:hash","https://jorropo.net/ipfs/:hash","https://ipfs.fooock.com/ipfs/:hash","https://cdn.cwinfo.net/ipfs/:hash","https://aragon.ventures/ipfs/:hash","https://permaweb.io/ipfs/:hash","https://ipfs.best-practice.se/ipfs/:hash","https://storjipfs-gateway.com/ipfs/:hash","https://ipfs.runfission.com/ipfs/:hash","https://ipfs.trusti.id/ipfs/:hash","https://ipfs.overpi.com/ipfs/:hash","https://ipfs.ink/ipfs/:hash","https://ipfsgateway.makersplace.com/ipfs/:hash","https://ipfs.funnychain.co/ipfs/:hash","https://ipfs.telos.miami/ipfs/:hash","https://ipfs.mttk.net/ipfs/:hash","https://ipfs.fleek.co/ipfs/:hash","https://ipfs.jbb.one/ipfs/:hash","https://ipfs.yt/ipfs/:hash","https://hashnews.k1ic.com/ipfs/:hash","https://ipfs.drink.cafe/ipfs/:hash","https://ipfs.kavin.rocks/ipfs/:hash","https://ipfs.denarius.io/ipfs/:hash","https://crustwebsites.net/ipfs/:hash","https://ipfs0.sjc.cloudsigma.com/ipfs/:hash","http://ipfs.genenetwork.org/ipfs/:hash","https://ipfs.eth.aragon.network/ipfs/:hash","https://ipfs.smartholdem.io/ipfs/:hash","https://ipfs.xoqq.ch/ipfs/:hash","http://natoboram.mynetgear.com:8080/ipfs/:hash","https://video.oneloveipfs.com/ipfs/:hash","http://ipfs.anonymize.com/ipfs/:hash","https://ipfs.scalaproject.io/ipfs/:hash","https://search.ipfsgate.com/ipfs/:hash","https://ipfs.decoo.io/ipfs/:hash","https://alexdav.id/ipfs/:hash","https://ipfs.uploads.nu/ipfs/:hash","https://hub.textile.io/ipfs/:hash","https://ipfs1.pixura.io/ipfs/:hash","https://ravencoinipfs-gateway.com/ipfs/:hash","https://konubinix.eu/ipfs/:hash","https://ipfs.tubby.cloud/ipfs/:hash","https://ipfs.lain.la/ipfs/:hash","https://ipfs.kaleido.art/ipfs/:hash","https://ipfs.slang.cx/ipfs/:hash","https://ipfs.arching-kaos.com/ipfs/:hash","https://storry.tv/ipfs/:hash","https://ipfs.1-2.dev/ipfs/:hash","https://dweb.eu.org/ipfs/:hash","https://permaweb.eu.org/ipfs/:hash","https://ipfs.namebase.io/ipfs/:hash","https://ipfs.tribecap.co/ipfs/:hash","https://ipfs.kinematiks.com/ipfs/:hash","https://c4rex.co/ipfs/:hash","https://nftstorage.link/ipfs/:hash","https://gravity.jup.io/ipfs/:hash","http://fzdqwfb5ml56oadins5jpuhe6ki6bk33umri35p5kt2tue4fpws5efid.onion/ipfs/:hash","https://tth-ipfs.com/ipfs/:hash","https://ipfs.chisdealhd.co.uk/ipfs/:hash","https://ipfs.alloyxuast.tk/ipfs/:hash","https://ipfs.litnet.work/ipfs/:hash","https://4everland.io/ipfs/:hash","https://ipfs-gateway.cloud/ipfs/:hash","https://w3s.link/ipfs/:hash","https://cthd.icu/ipfs/:hash"];var kt=new b("App index");window.checker=new at;window.checker.checkGateways(wt).catch(h=>{kt.error("Unexpected error"),kt.error(h)});})();
return IpfsPublicGatewayChecker}));
